const fs=require("fs"),path=require("path"),gltf=JSON.parse(fs.readFileSync("temp_player.gltf","utf8")),bin=fs.readFileSync("temp_player.bin"),bufferViews=gltf.bufferViews||[],accessors=gltf.accessors||[];function getTyped(e){const t=accessors[e];if(!t)return null;const s=bufferViews[t.bufferView];if(!s)return null;const n=(s.byteOffset||0)+(t.byteOffset||0),r=t.count,o=t.componentType;let a;switch(o){case 5126:a=Float32Array;break;case 5123:a=Uint16Array;break;case 5121:a=Uint8Array;break;default:throw new Error("Unsupported component type "+o)}const i=r*a.BYTES_PER_ELEMENT,m=bin.subarray(n,n+i),f=new a(m.buffer,m.byteOffset,r);return Array.from(f)}const animInfo=[];(gltf.animations||[]).forEach((e,t)=>{(e.samplers||[]).forEach((s,n)=>{const r=getTyped(s.input);r&&r.length&&animInfo.push({animation:e.name||`animation_${t}`,sampler:n,times:r})})}),animInfo.length||(console.error("No animation samplers with input keyframes found."),process.exit(1)),animInfo.sort((e,t)=>t.times.length-e.times.length);const primary=animInfo[0],times=primary.times,diffs=[];for(let e=1;e<times.length;e++)diffs.push(times[e]-times[e-1]);const minStep=Math.min(...diffs.filter(e=>e>1e-5)),avgStep=diffs.reduce((e,t)=>e+t,0)/diffs.length,fpsEstimate=Math.round(1/minStep);console.log("Sampler:",primary.animation,"sampler",primary.sampler),console.log("Keyframe count:",times.length),console.log("Duration (s):",times[times.length-1]),console.log("Min delta (s):",minStep,"Avg delta (s):",avgStep,"Approx FPS:",fpsEstimate);const threshold=1.2*minStep,segments=[];let current={start:times[0],end:times[0]};for(let e=1;e<times.length;e++)times[e]-times[e-1]>threshold?(segments.push(current),current={start:times[e],end:times[e]}):current.end=times[e];function toFrame(e){return Math.round(e/minStep)}segments.push(current),console.log("Detected segments:",segments.length),segments.forEach((e,t)=>{console.log(t.toString().padStart(2,"0"),"Start:",e.start.toFixed(4),"End:",e.end.toFixed(4),"Frames:",toFrame(e.start),"-",toFrame(e.end),"Length:",toFrame(e.end)-toFrame(e.start))});