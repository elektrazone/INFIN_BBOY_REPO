"use strict";(self.webpackChunkbabylon_react_916_canvas=self.webpackChunkbabylon_react_916_canvas||[]).push([[238],{238:(e,t,o)=>{o.r(t),o.d(t,{default:()=>s});var n=o(848),r=o(540),a=o(828);o(988),a.DracoCompression&&(a.DracoCompression.Configuration={decoder:{wasmUrl:"https://cdn.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://cdn.babylonjs.com/draco_wasm_wrapper_gltf.wasm",fallbackUrl:"https://cdn.babylonjs.com/draco_decoder_gltf.js"}});const s=()=>{const e=(0,r.useRef)(null);return(0,r.useEffect)(()=>{const t=e.current;if(!t)return;let o=null;const n=()=>{if(!o)return;const e=Math.max(1,t.height/1080);o.setHardwareScalingLevel(Math.min(2.5,e))},r=()=>{let e=Math.min(window.innerHeight,3840),r=9*e/16;r>2160&&(r=2160,e=Math.min(16*r/9,3840)),t.width=r,t.height=e,t.style.width=`${r}px`,t.style.height=`${e}px`,o&&(o.resize(),n())};r(),o=new a.Engine(t,!0),n();const s=new a.Scene(o),i=[];let l=0;const c=[];let d=null;const u=102;let f=0;const h={Idle:[0,175],Run:[176,217],Strafe_L:[364,403],Strafe_R:[404,443]},p=(e,t)=>{const[o,n]=h[e];return{start:o,end:n,loop:!0,scroll:t}},g={Idle:p("Idle",0),Run:p("Run",u),Slide:{start:218,end:309,loop:!1,scroll:u},Jump:{start:310,end:363,loop:!1,scroll:u},Strafe_L:p("Strafe_L",u),Strafe_R:p("Strafe_R",u),Run_Idle:{start:444,end:497,loop:!1,scroll:0},Fall:{start:498,end:649,loop:!1,scroll:u},Getup:{start:650,end:1106,loop:!1,scroll:u}},w=(e,t)=>{if(y){const t=y.getAnimationRange(e);if(t)return{start:t.from,end:t.to}}return{start:t.start,end:t.end}},m=new Set(["Slide","Jump","Fall","Getup"]),b={forward:!1,left:!1,right:!1,slide:!1};let y=null,M=null,v=null,_=null,S="Idle",E=!1,x=null,R=null,A=!1;const L={target:0},I=()=>{v&&(v.stop(),v=null),_&&M&&(M.onAnimationEndObservable.remove(_),_=null)},T=(e,t=!1)=>{if(!t&&S===e)return;if(!t&&m.has(S))return;E=!!m.has(e);const o=w(e,g[e]);if(!M||!y)return void(S=e);if(I(),M.start(!1,1,o.start,o.end,!1),v=M.animatables[0]||null,!v)return void(S=e);const n=g[e];n.loop?v.loopAnimation=!0:(v.loopAnimation=!1,_=M.onAnimationEndObservable.add(()=>{E=!1,"Slide"===e||"Jump"===e?T("Run",!0):("Getup"===e||"Run_Idle"===e)&&T("Idle",!0)})),f=n.scroll,S=e},k=()=>{if(!M||A)return;const e=w("Idle",g.Idle);M.start(!0,1,e.start,e.end,!0),v=M.animatables[0]||null,A=!0},O=e=>{switch(e.code){case"ArrowUp":case"KeyW":b.forward=!0;break;case"ArrowLeft":case"KeyA":b.left=!0;break;case"ArrowRight":case"KeyD":b.right=!0;break;case"ArrowDown":case"KeyS":b.slide=!0}},D=e=>{switch(e.code){case"ArrowUp":case"KeyW":b.forward=!1;break;case"ArrowLeft":case"KeyA":b.left=!1;break;case"ArrowRight":case"KeyD":b.right=!1;break;case"ArrowDown":case"KeyS":b.slide=!1}},V=e=>Math.max(-40,Math.min(40,e));R=s.onBeforeRenderObservable.add(()=>{const e=s.getEngine().getDeltaTime()/1e3;if((()=>{if(!x)return;const e=b.left&&!b.right,t=b.right&&!b.left,o=b.slide,n=b.forward||E;T(o?"Slide":e?"Strafe_L":t?"Strafe_R":n?"Run":"Idle")})(),!x)return;const t=x.position.clone();if(b.left&&!b.right)L.target=V(L.target-40*e);else if(b.right&&!b.left)L.target=V(L.target+40*e);else{const t=40*Math.sign(-L.target)*e;Math.abs(t)>Math.abs(L.target)?L.target=0:L.target+=t}t.x=L.target,x.position=t}),new a.HemisphericLight("light",new a.Vector3(0,1,0),s).intensity=.9,new a.ArcRotateCamera("camera",Math.PI/2,Math.PI/3,12,new a.Vector3(0,3,0),s).attachControl(t,!0);const C=new a.ShadowGenerator(2048,new a.DirectionalLight("dirLight",new a.Vector3(-.5,-1,.5),s));C.useExponentialShadowMap=!0;const B="undefined"!=typeof window&&window.location.hostname.endsWith("github.io")?"https://media.githubusercontent.com/media/elektrazone/INFIN_BBOY_REPO/main/public/scene/assets/":"scene/assets/",N=`${B}model/`,$=`${B}road/`,z=1e3,P={u:1,v:Math.max(1,2)},G=new a.StandardMaterial("groundMaterial",s);G.diffuseColor=new a.Color3(.12,.12,.14),G.specularColor=new a.Color3(.02,.02,.02),G.emissiveColor=new a.Color3(.01,.01,.012);const K=e=>{e.uScale=P.u,e.vScale=P.v,e.wrapU=a.Texture.CLAMP_ADDRESSMODE,e.wrapV=a.Texture.WRAP_ADDRESSMODE,e.hasAlpha=!1},{packagedTexture:j,dynamicTexture:Q}=(()=>{const e=`${$}fallback-road-texture.png`,t=new a.Texture(e,s,void 0,!1,a.Texture.TRILINEAR_SAMPLINGMODE,void 0,()=>{t.dispose()});t.onLoadObservable.addOnce(()=>{t.updateSamplingMode(a.Texture.TRILINEAR_SAMPLINGMODE)});const o=new a.DynamicTexture("runner-road-fallback",{width:1024,height:1024},s,!1),n=o.getContext();if(n){const e=1024;n.fillStyle="#201f2b",n.fillRect(0,0,e,e),n.fillStyle="#14131d",n.fillRect(0,.08*e,e,.84*e),n.fillStyle="#fcd75a";const t=Math.max(1,Math.round(.06*e)),o=Math.max(1,Math.round(.1*e)),r=Math.max(1,1.6*o),a=(e-t)/2;for(let s=.35*e;s<e+o;s+=o+r)n.fillRect(a,s,t,o)}return o.update(!1),{packagedTexture:t,dynamicTexture:o}})();K(Q),G.diffuseTexture=Q;let W=Q;const H={offset:0};let U=null;const F=e=>{K(e),G.diffuseTexture=e,W=e};j.onLoadObservable.addOnce(()=>{F(j)});const J=`${$}road_texture.jpg`;U=new a.Texture(J,s,void 0,!1,a.Texture.TRILINEAR_SAMPLINGMODE,()=>{U&&F(U)},()=>{j&&j.isReady()?F(j):F(Q)}),U.onLoadObservable.addOnce(()=>{U&&F(U)});const Z=e=>{const t=a.MeshBuilder.CreateGround(`ground-${e}`,{width:250,height:1e3},s);t.position=new a.Vector3(0,0,-e*z),t.material=G,t.receiveShadows=!0,c.push(t)};for(let e=0;e<1;e+=1)Z(e);const Y=(e,t,o)=>{if(0===e.length)return;e.forEach(e=>{e.position.z+=o});let n=1/0;e.forEach(e=>{e.position.z<n&&(n=e.position.z)}),e.forEach(e=>{e.position.z>t&&(e.position.z=n-t)})};d=s.onBeforeRenderObservable.add(()=>{const e=s.getEngine().getDeltaTime()/1e3,t=f*e;0!==t&&(Y(c,z,t),l>0&&Y(i,l,t),H.offset+=t/z,H.offset%=1,H.offset<0&&(H.offset+=1),W.vOffset=H.offset)});const q=N;a.SceneLoader.ImportMesh(null,q,"player.glb",s,(e,t,o,n)=>{if(console.log("Loaded meshes:",e),console.log("Loaded animationGroups:",n),0===e.length)return void console.error("No meshes loaded from player.glb");const r=new a.TransformNode("playerRoot",s);e.forEach(e=>{e.parent=r,e.alwaysSelectAsActiveMesh=!0,e.setEnabled(!0),e instanceof a.Mesh&&(e.receiveShadows=!0,C.addShadowCaster(e,!0))}),r.position=a.Vector3.Zero(),r.scaling=a.Vector3.One(),r.computeWorldMatrix(!0);const{min:i,max:l}=r.getHierarchyBoundingVectors(),c=l.y-i.y,d=c>0?3.2/c:1;r.scaling=new a.Vector3(d,d,d),r.computeWorldMatrix(!0);const{min:u,max:f}=r.getHierarchyBoundingVectors(),h=u.add(f).scale(.5);r.position=new a.Vector3(-h.x,.05-u.y,7.5-h.z),r.computeWorldMatrix(!0),x=r,y=o[0]||null,M=n[0]||null,n.forEach(e=>e.stop()),k()},void 0,(e,t,o)=>{console.error("Error loading player.glb:",t,o)});const X=Array.from({length:10},(e,t)=>`b${t+1}.glb`);return Promise.all(X.map(e=>a.SceneLoader.ImportMeshAsync(null,q,e,s).then(e=>e.meshes.filter(e=>e instanceof a.Mesh)))).then(e=>{const t=e.flat();if(0===t.length)return void console.error("No renderable meshes found in b1â€“b10 assets.");const o=new Map;t.forEach(e=>{e.scaling=e.scaling.scale(8),o.set(e,{position:e.position.clone(),rotation:e.rotation?e.rotation.clone():null,rotationQuaternion:e.rotationQuaternion?e.rotationQuaternion.clone():null,scaling:e.scaling.clone()}),e.isVisible=!1,e.setEnabled(!1)});const n=(e,n,r)=>{const i=new a.TransformNode(n,s);return i.parent=e,i.rotation=new a.Vector3(0,r,0),t.forEach(e=>{const t=e.createInstance(`${e.name}-${n}`);t.parent=i,((e,t)=>{const n=o.get(t);n&&(e.position=n.position.clone(),e.scaling=n.scaling.clone(),n.rotationQuaternion?(e.rotationQuaternion=n.rotationQuaternion.clone(),e.rotation=a.Vector3.Zero()):n.rotation&&(e.rotation=n.rotation.clone(),e.rotationQuaternion=null))})(t,e),t.receiveShadows=!0,t.alwaysSelectAsActiveMesh=!0}),i},r=new a.TransformNode("buildingsSeg-0",s);r.position=a.Vector3.Zero(),n(r,"B_a_group_seg-0",0),n(r,"B_b_group_seg-0",Math.PI);const{min:c,max:d}=r.getHierarchyBoundingVectors(),u=Math.abs(d.z-c.z),f=Math.max(u-1,10);l=f;const h=(e,t)=>{e.position=new a.Vector3(0,0,-t*f),i.push(e)},p=e=>{const t=new a.TransformNode(`buildingsSeg-${e}`,s);t.position=new a.Vector3(0,0,-e*f),n(t,`B_a_group_seg-${e}`,0),n(t,`B_b_group_seg-${e}`,Math.PI),h(t,e)};h(r,0);for(let e=1;e<6;e+=1)p(e)}).catch(e=>{console.error("Error loading building assets:",e)}),o.runRenderLoop(()=>{k(),s.render()}),window.addEventListener("resize",r),window.addEventListener("keydown",O),window.addEventListener("keyup",D),()=>{window.removeEventListener("resize",r),window.removeEventListener("keydown",O),window.removeEventListener("keyup",D),d&&s.onBeforeRenderObservable.remove(d),R&&s.onBeforeRenderObservable.remove(R),I(),i.forEach(e=>e.dispose()),c.forEach(e=>e.dispose()),o.dispose()}},[]),(0,n.jsx)("canvas",{ref:e,style:{display:"block",margin:"0 auto"}})}}}]);