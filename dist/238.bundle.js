"use strict";(self.webpackChunkbabylon_react_916_canvas=self.webpackChunkbabylon_react_916_canvas||[]).push([[238],{238:(e,t,o)=>{o.r(t),o.d(t,{default:()=>s});var n=o(848),r=o(540),a=o(828);o(988),a.DracoCompression&&(a.DracoCompression.Configuration={decoder:{wasmUrl:"https://cdn.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://cdn.babylonjs.com/draco_wasm_wrapper_gltf.wasm",fallbackUrl:"https://cdn.babylonjs.com/draco_decoder_gltf.js"}});const s=()=>{const e=(0,r.useRef)(null);return(0,r.useEffect)(()=>{const t=e.current;if(!t)return;let o=null;const n=()=>{if(!o)return;const e=Math.max(1,t.height/1080);o.setHardwareScalingLevel(Math.min(2.5,e))},r=()=>{let e=Math.min(window.innerHeight,3840),r=9*e/16;r>2160&&(r=2160,e=Math.min(16*r/9,3840)),t.width=r,t.height=e,t.style.width=`${r}px`,t.style.height=`${e}px`,o&&(o.resize(),n())};r(),o=new a.Engine(t,!0),n();const s=new a.Scene(o),i=[];let l=0;const c=[];let d=null;const u=102;let f=0;const g={Idle:[0,175],Run:[176,217],Strafe_L:[364,403],Strafe_R:[404,443]},h=(e,t)=>{const[o,n]=g[e];return{start:o,end:n,loop:!0,scroll:t}},p={Idle:h("Idle",0),Run:h("Run",u),Slide:{start:218,end:309,loop:!1,scroll:u},Jump:{start:310,end:363,loop:!1,scroll:u},Strafe_L:h("Strafe_L",u),Strafe_R:h("Strafe_R",u),Run_Idle:{start:444,end:497,loop:!1,scroll:0},Fall:{start:498,end:649,loop:!1,scroll:u},Getup:{start:650,end:1106,loop:!1,scroll:u}},w=(e,t)=>{if(_){const t=_.getAnimationRange(e);if(t)return{start:t.from,end:t.to}}return{start:t.start,end:t.end}},m=new Set(["Slide","Jump","Fall","Getup"]),b={forward:!1,left:!1,right:!1,slide:!1};let _=null,v=null,y=null,S=null,E="Idle",M=!1,R=null,I=null,L=!1;const A={target:0},k=()=>{y&&(y.stop(),y=null),S&&v&&(v.onAnimationEndObservable.remove(S),S=null)},B=(e,t=!1)=>{if(!t&&E===e)return;if(!t&&m.has(E))return;M=!!m.has(e);const o=w(e,p[e]);if(!v||!_)return void(E=e);if(k(),v.start(!1,1,o.start,o.end,!1),y=v.animatables[0]||null,!y)return void(E=e);const n=p[e];n.loop?y.loopAnimation=!0:(y.loopAnimation=!1,S=v.onAnimationEndObservable.add(()=>{M=!1,"Slide"===e||"Jump"===e?B("Run",!0):("Getup"===e||"Run_Idle"===e)&&B("Idle",!0)})),f=n.scroll,E=e},x=()=>{if(!v||L)return;const e=w("Idle",p.Idle);v.start(!0,1,e.start,e.end,!0),y=v.animatables[0]||null,L=!0},V=e=>{switch(e.code){case"ArrowUp":case"KeyW":b.forward=!0;break;case"ArrowLeft":case"KeyA":b.left=!0;break;case"ArrowRight":case"KeyD":b.right=!0;break;case"ArrowDown":case"KeyS":b.slide=!0}},z=e=>{switch(e.code){case"ArrowUp":case"KeyW":b.forward=!1;break;case"ArrowLeft":case"KeyA":b.left=!1;break;case"ArrowRight":case"KeyD":b.right=!1;break;case"ArrowDown":case"KeyS":b.slide=!1}},C=e=>Math.max(-40,Math.min(40,e));I=s.onBeforeRenderObservable.add(()=>{const e=s.getEngine().getDeltaTime()/1e3;if((()=>{if(!R)return;const e=b.left&&!b.right,t=b.right&&!b.left,o=b.slide,n=b.forward||M;B(o?"Slide":e?"Strafe_L":t?"Strafe_R":n?"Run":"Idle")})(),!R)return;const t=R.position.clone();if(b.left&&!b.right)A.target=C(A.target-40*e);else if(b.right&&!b.left)A.target=C(A.target+40*e);else{const t=40*Math.sign(-A.target)*e;Math.abs(t)>Math.abs(A.target)?A.target=0:A.target+=t}t.x=A.target,R.position=t}),new a.HemisphericLight("light",new a.Vector3(0,1,0),s).intensity=.9,new a.ArcRotateCamera("camera",Math.PI/2,Math.PI/3,12,new a.Vector3(0,3,0),s).attachControl(t,!0);const D=new a.ShadowGenerator(2048,new a.DirectionalLight("dirLight",new a.Vector3(-.5,-1,.5),s));D.useExponentialShadowMap=!0;const O=new a.Texture("scene/assets/road/road_texture.jpg",s);O.uScale=1,O.vScale=8;const $=new a.StandardMaterial("groundMaterial",s);$.diffuseTexture=O;const K={offset:0},j=O,N=e=>{const t=a.MeshBuilder.CreateGround(`ground-${e}`,{width:40,height:160},s);t.position=new a.Vector3(0,0,160*-e),t.material=$,t.receiveShadows=!0,c.push(t)};for(let e=0;e<8;e+=1)N(e);const Q=(e,t,o)=>{if(0===e.length)return;e.forEach(e=>{e.position.z+=o});let n=1/0;e.forEach(e=>{e.position.z<n&&(n=e.position.z)}),e.forEach(e=>{e.position.z>t&&(e.position.z=n-t)})};d=s.onBeforeRenderObservable.add(()=>{const e=s.getEngine().getDeltaTime()/1e3,t=f*e;0!==t&&(Q(c,160,t),l>0&&Q(i,l,t),K.offset+=t/160,K.offset%=1,K.offset<0&&(K.offset+=1),j.vOffset=K.offset)});const T="undefined"!=typeof window&&window.location.hostname.endsWith("github.io")?"https://media.githubusercontent.com/media/elektrazone/INFIN_BBOY_REPO/main/public/scene/assets/model/":"scene/assets/model/";a.SceneLoader.ImportMesh(null,T,"player.glb",s,(e,t,o,n)=>{if(console.log("Loaded meshes:",e),console.log("Loaded animationGroups:",n),0===e.length)return void console.error("No meshes loaded from player.glb");const r=e[0];if(r.position=new a.Vector3(0,0,0),r.scaling=new a.Vector3(8,8,8),R=r,_=o[0]||null,D.addShadowCaster(r,!0),r.getBoundingInfo){const e=r.getBoundingInfo().boundingBox.centerWorld;r.position=r.position.subtract(e)}v=n[0]||null,n.forEach(e=>e.stop()),x()},void 0,(e,t,o)=>{console.error("Error loading player.glb:",t,o)});const G=Array.from({length:10},(e,t)=>`b${t+1}.glb`);return Promise.all(G.map(e=>a.SceneLoader.ImportMeshAsync(null,T,e,s).then(e=>e.meshes.filter(e=>e instanceof a.Mesh)))).then(e=>{const t=e.flat();if(0===t.length)return void console.error("No renderable meshes found in b1â€“b10 assets.");const o=new Map;t.forEach(e=>{e.scaling=e.scaling.scale(8),o.set(e,{position:e.position.clone(),rotation:e.rotation?e.rotation.clone():null,rotationQuaternion:e.rotationQuaternion?e.rotationQuaternion.clone():null,scaling:e.scaling.clone()}),e.isVisible=!1,e.setEnabled(!1)});const n=(e,n,r)=>{const i=new a.TransformNode(n,s);return i.parent=e,i.rotation=new a.Vector3(0,r,0),t.forEach(e=>{const t=e.createInstance(`${e.name}-${n}`);t.parent=i,((e,t)=>{const n=o.get(t);n&&(e.position=n.position.clone(),e.scaling=n.scaling.clone(),n.rotationQuaternion?(e.rotationQuaternion=n.rotationQuaternion.clone(),e.rotation=a.Vector3.Zero()):n.rotation&&(e.rotation=n.rotation.clone(),e.rotationQuaternion=null))})(t,e),t.receiveShadows=!0,t.alwaysSelectAsActiveMesh=!0}),i},r=new a.TransformNode("buildingsSeg-0",s);r.position=a.Vector3.Zero(),n(r,"B_a_group_seg-0",0),n(r,"B_b_group_seg-0",Math.PI);const{min:c,max:d}=r.getHierarchyBoundingVectors(),u=Math.abs(d.z-c.z),f=Math.max(u-1,10);l=f;const g=(e,t)=>{e.position=new a.Vector3(0,0,-t*f),i.push(e)},h=e=>{const t=new a.TransformNode(`buildingsSeg-${e}`,s);t.position=new a.Vector3(0,0,-e*f),n(t,`B_a_group_seg-${e}`,0),n(t,`B_b_group_seg-${e}`,Math.PI),g(t,e)};g(r,0);for(let e=1;e<6;e+=1)h(e)}).catch(e=>{console.error("Error loading building assets:",e)}),o.runRenderLoop(()=>{x(),s.render()}),window.addEventListener("resize",r),window.addEventListener("keydown",V),window.addEventListener("keyup",z),()=>{window.removeEventListener("resize",r),window.removeEventListener("keydown",V),window.removeEventListener("keyup",z),d&&s.onBeforeRenderObservable.remove(d),I&&s.onBeforeRenderObservable.remove(I),k(),i.forEach(e=>e.dispose()),c.forEach(e=>e.dispose()),o.dispose()}},[]),(0,n.jsx)("canvas",{ref:e,style:{display:"block",margin:"0 auto"}})}}}]);