"use strict";(self.webpackChunkbabylon_react_916_canvas=self.webpackChunkbabylon_react_916_canvas||[]).push([[238],{238:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});var o=n(848),r=n(540),a=n(828);n(988),a.DracoCompression&&(a.DracoCompression.Configuration={decoder:{wasmUrl:"https://cdn.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://cdn.babylonjs.com/draco_wasm_wrapper_gltf.wasm",fallbackUrl:"https://cdn.babylonjs.com/draco_decoder_gltf.js"}});const s=()=>{const e=(0,r.useRef)(null);return(0,r.useEffect)(()=>{const t=e.current;if(!t)return;let n=null;const o=()=>{if(!n)return;const e=Math.max(1,t.height/1080);n.setHardwareScalingLevel(Math.min(2.5,e))},r=()=>{let e=Math.min(window.innerHeight,3840),r=9*e/16;r>2160&&(r=2160,e=Math.min(16*r/9,3840)),t.width=r,t.height=e,t.style.width=`${r}px`,t.style.height=`${e}px`,n&&(n.resize(),o())};r(),n=new a.Engine(t,!0),o();const s=new a.Scene(n),l=[];let i=null;const d=102;let c=0;const f={Idle:[0,175],Run:[176,217],Strafe_L:[364,403],Strafe_R:[404,443]},u=(e,t)=>{const[n,o]=f[e];return{start:n,end:o,loop:!0,scroll:t}},h={Idle:u("Idle",0),Run:u("Run",d),Slide:{start:218,end:309,loop:!1,scroll:d},Jump:{start:310,end:363,loop:!1,scroll:d},Strafe_L:u("Strafe_L",d),Strafe_R:u("Strafe_R",d),Run_Idle:{start:444,end:497,loop:!1,scroll:0},Fall:{start:498,end:649,loop:!1,scroll:d},Getup:{start:650,end:1106,loop:!1,scroll:d}},w=(e,t)=>{if(m){const t=m.getAnimationRange(e);if(t)return{start:t.from,end:t.to}}return{start:t.start,end:t.end}},p=new Set(["Slide","Jump","Fall","Getup"]),g={forward:!1,left:!1,right:!1,slide:!1};let m=null,b=null,v=null,y=null,_="Idle",S=!1,R=null,E=null,L=!1;const k={target:0},I=()=>{v&&(v.stop(),v=null),y&&b&&(b.onAnimationEndObservable.remove(y),y=null)},A=(e,t=!1)=>{if(!t&&_===e)return;if(!t&&p.has(_))return;S=!!p.has(e);const n=w(e,h[e]);if(!b||!m)return void(_=e);if(I(),b.start(!1,1,n.start,n.end,!1),v=b.animatables[0]||null,!v)return void(_=e);const o=h[e];o.loop?v.loopAnimation=!0:(v.loopAnimation=!1,y=b.onAnimationEndObservable.add(()=>{S=!1,"Slide"===e||"Jump"===e?A("Run",!0):("Getup"===e||"Run_Idle"===e)&&A("Idle",!0)})),c=o.scroll,_=e},M=()=>{if(!b||L)return;const e=w("Idle",h.Idle);b.start(!0,1,e.start,e.end,!0),v=b.animatables[0]||null,L=!0},x=e=>{switch(e.code){case"ArrowUp":case"KeyW":g.forward=!0;break;case"ArrowLeft":case"KeyA":g.left=!0;break;case"ArrowRight":case"KeyD":g.right=!0;break;case"ArrowDown":case"KeyS":g.slide=!0}},B=e=>{switch(e.code){case"ArrowUp":case"KeyW":g.forward=!1;break;case"ArrowLeft":case"KeyA":g.left=!1;break;case"ArrowRight":case"KeyD":g.right=!1;break;case"ArrowDown":case"KeyS":g.slide=!1}},z=e=>Math.max(-40,Math.min(40,e));E=s.onBeforeRenderObservable.add(()=>{const e=s.getEngine().getDeltaTime()/1e3;if((()=>{if(!R)return;const e=g.left&&!g.right,t=g.right&&!g.left,n=g.slide,o=g.forward||S;A(n?"Slide":e?"Strafe_L":t?"Strafe_R":o?"Run":"Idle")})(),!R)return;const t=R.position.clone();if(g.left&&!g.right)k.target=z(k.target-40*e);else if(g.right&&!g.left)k.target=z(k.target+40*e);else{const t=40*Math.sign(-k.target)*e;Math.abs(t)>Math.abs(k.target)?k.target=0:k.target+=t}t.x=k.target,R.position=t}),new a.HemisphericLight("light",new a.Vector3(0,1,0),s).intensity=.9,new a.ArcRotateCamera("camera",Math.PI/2,Math.PI/3,12,new a.Vector3(0,3,0),s).attachControl(t,!0);const C=new a.ShadowGenerator(2048,new a.DirectionalLight("dirLight",new a.Vector3(-.5,-1,.5),s));C.useExponentialShadowMap=!0;const D=160,O=new a.Texture("scene/assets/road/road_texture.jpg",s);O.uScale=1,O.vScale=8;const K=new a.StandardMaterial("groundMaterial",s);K.diffuseTexture=O;const j={offset:0},G=O,V=e=>{const t=a.MeshBuilder.CreateGround(`ground-${e}`,{width:40,height:160},s);t.position=new a.Vector3(0,0,-e*D),t.material=K,t.receiveShadows=!0,l.push(t)};for(let e=0;e<8;e+=1)V(e);const U="undefined"!=typeof window&&window.location.hostname.endsWith("github.io")?"https://media.githubusercontent.com/media/elektrazone/INFIN_BBOY_REPO/main/public/scene/assets/model/":"scene/assets/model/";return a.SceneLoader.ImportMesh(null,U,"player.glb",s,(e,t,n,o)=>{if(console.log("Loaded meshes:",e),console.log("Loaded animationGroups:",o),0===e.length)return void console.error("No meshes loaded from player.glb");const r=e[0];if(r.position=new a.Vector3(0,0,0),r.scaling=new a.Vector3(8,8,8),R=r,m=n[0]||null,C.addShadowCaster(r,!0),r.getBoundingInfo){const e=r.getBoundingInfo().boundingBox.centerWorld;r.position=r.position.subtract(e)}b=o[0]||null,o.forEach(e=>e.stop()),M()},void 0,(e,t,n)=>{console.error("Error loading player.glb:",t,n)}),i=s.onBeforeRenderObservable.add(()=>{const e=s.getEngine().getDeltaTime()/1e3,t=c*e;if(0===t)return;l.forEach(e=>{e.position.z+=t});let n=1/0;l.forEach(e=>{e.position.z<n&&(n=e.position.z)}),l.forEach(e=>{e.position.z>D&&(e.position.z=n-D)}),j.offset+=t/D,j.offset%=1,j.offset<0&&(j.offset+=1),G.vOffset=j.offset}),n.runRenderLoop(()=>{M(),s.render()}),window.addEventListener("resize",r),window.addEventListener("keydown",x),window.addEventListener("keyup",B),()=>{window.removeEventListener("resize",r),window.removeEventListener("keydown",x),window.removeEventListener("keyup",B),i&&s.onBeforeRenderObservable.remove(i),E&&s.onBeforeRenderObservable.remove(E),I(),l.forEach(e=>e.dispose()),n.dispose()}},[]),(0,o.jsx)("canvas",{ref:e,style:{display:"block",margin:"0 auto"}})}}}]);