"use strict";(self.webpackChunkbabylon_react_916_canvas=self.webpackChunkbabylon_react_916_canvas||[]).push([[238],{238:(e,t,o)=>{o.r(t),o.d(t,{default:()=>s});var n=o(848),r=o(540),a=o(828);o(988),a.DracoCompression&&(a.DracoCompression.Configuration={decoder:{wasmUrl:"https://cdn.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://cdn.babylonjs.com/draco_wasm_wrapper_gltf.wasm",fallbackUrl:"https://cdn.babylonjs.com/draco_decoder_gltf.js"}});const s=()=>{const e=(0,r.useRef)(null);return(0,r.useEffect)(()=>{const t=e.current;if(!t)return;let o=null;const n=()=>{if(!o)return;const e=Math.max(1,t.height/1080);o.setHardwareScalingLevel(Math.min(2.5,e))},r=()=>{let e=Math.min(window.innerHeight,3840),r=9*e/16;r>2160&&(r=2160,e=Math.min(16*r/9,3840)),t.width=r,t.height=e,t.style.width=`${r}px`,t.style.height=`${e}px`,o&&(o.resize(),n())};r(),o=new a.Engine(t,!0),n();const s=new a.Scene(o),i=[],l=[];let c=null;const d=102;let u=0;const f={Idle:[0,175],Run:[176,217],Strafe_L:[364,403],Strafe_R:[404,443]},g=(e,t)=>{const[o,n]=f[e];return{start:o,end:n,loop:!0,scroll:t}},h={Idle:g("Idle",0),Run:g("Run",d),Slide:{start:218,end:309,loop:!1,scroll:d},Jump:{start:310,end:363,loop:!1,scroll:d},Strafe_L:g("Strafe_L",d),Strafe_R:g("Strafe_R",d),Run_Idle:{start:444,end:497,loop:!1,scroll:0},Fall:{start:498,end:649,loop:!1,scroll:d},Getup:{start:650,end:1106,loop:!1,scroll:d}},p=(e,t)=>{if(b){const t=b.getAnimationRange(e);if(t)return{start:t.from,end:t.to}}return{start:t.start,end:t.end}},w=new Set(["Slide","Jump","Fall","Getup"]),m={forward:!1,left:!1,right:!1,slide:!1};let b=null,_=null,v=null,y=null,S="Idle",E=!1,M=null,R=null,I=!1;const L={target:0},A=()=>{v&&(v.stop(),v=null),y&&_&&(_.onAnimationEndObservable.remove(y),y=null)},k=(e,t=!1)=>{if(!t&&S===e)return;if(!t&&w.has(S))return;E=!!w.has(e);const o=p(e,h[e]);if(!_||!b)return void(S=e);if(A(),_.start(!1,1,o.start,o.end,!1),v=_.animatables[0]||null,!v)return void(S=e);const n=h[e];n.loop?v.loopAnimation=!0:(v.loopAnimation=!1,y=_.onAnimationEndObservable.add(()=>{E=!1,"Slide"===e||"Jump"===e?k("Run",!0):("Getup"===e||"Run_Idle"===e)&&k("Idle",!0)})),u=n.scroll,S=e},B=()=>{if(!_||I)return;const e=p("Idle",h.Idle);_.start(!0,1,e.start,e.end,!0),v=_.animatables[0]||null,I=!0},x=e=>{switch(e.code){case"ArrowUp":case"KeyW":m.forward=!0;break;case"ArrowLeft":case"KeyA":m.left=!0;break;case"ArrowRight":case"KeyD":m.right=!0;break;case"ArrowDown":case"KeyS":m.slide=!0}},V=e=>{switch(e.code){case"ArrowUp":case"KeyW":m.forward=!1;break;case"ArrowLeft":case"KeyA":m.left=!1;break;case"ArrowRight":case"KeyD":m.right=!1;break;case"ArrowDown":case"KeyS":m.slide=!1}},z=e=>Math.max(-40,Math.min(40,e));R=s.onBeforeRenderObservable.add(()=>{const e=s.getEngine().getDeltaTime()/1e3;if((()=>{if(!M)return;const e=m.left&&!m.right,t=m.right&&!m.left,o=m.slide,n=m.forward||E;k(o?"Slide":e?"Strafe_L":t?"Strafe_R":n?"Run":"Idle")})(),!M)return;const t=M.position.clone();if(m.left&&!m.right)L.target=z(L.target-40*e);else if(m.right&&!m.left)L.target=z(L.target+40*e);else{const t=40*Math.sign(-L.target)*e;Math.abs(t)>Math.abs(L.target)?L.target=0:L.target+=t}t.x=L.target,M.position=t}),new a.HemisphericLight("light",new a.Vector3(0,1,0),s).intensity=.9,new a.ArcRotateCamera("camera",Math.PI/2,Math.PI/3,12,new a.Vector3(0,3,0),s).attachControl(t,!0);const C=new a.ShadowGenerator(2048,new a.DirectionalLight("dirLight",new a.Vector3(-.5,-1,.5),s));C.useExponentialShadowMap=!0;const D=new a.Texture("scene/assets/road/road_texture.jpg",s);D.uScale=1,D.vScale=8;const O=new a.StandardMaterial("groundMaterial",s);O.diffuseTexture=D;const $={offset:0},K=D,j=e=>{const t=a.MeshBuilder.CreateGround(`ground-${e}`,{width:40,height:160},s);t.position=new a.Vector3(0,0,160*-e),t.material=O,t.receiveShadows=!0,l.push(t)};for(let e=0;e<8;e+=1)j(e);const N="undefined"!=typeof window&&window.location.hostname.endsWith("github.io")?"https://media.githubusercontent.com/media/elektrazone/INFIN_BBOY_REPO/main/public/scene/assets/model/":"scene/assets/model/";a.SceneLoader.ImportMesh(null,N,"player.glb",s,(e,t,o,n)=>{if(console.log("Loaded meshes:",e),console.log("Loaded animationGroups:",n),0===e.length)return void console.error("No meshes loaded from player.glb");const r=e[0];if(r.position=new a.Vector3(0,0,0),r.scaling=new a.Vector3(8,8,8),M=r,b=o[0]||null,C.addShadowCaster(r,!0),r.getBoundingInfo){const e=r.getBoundingInfo().boundingBox.centerWorld;r.position=r.position.subtract(e)}_=n[0]||null,n.forEach(e=>e.stop()),B()},void 0,(e,t,o)=>{console.error("Error loading player.glb:",t,o)});const Q=Array.from({length:10},(e,t)=>`b${t+1}.glb`);return Promise.all(Q.map(e=>a.SceneLoader.ImportMeshAsync(null,N,e,s).then(e=>e.meshes.filter(e=>e instanceof a.Mesh)))).then(e=>{const t=e.flat();if(0===t.length)return void console.error("No renderable meshes found in b1â€“b10 assets.");const o=new Map;t.forEach(e=>{e.scaling=e.scaling.scale(8),o.set(e,{position:e.position.clone(),rotation:e.rotation?e.rotation.clone():null,rotationQuaternion:e.rotationQuaternion?e.rotationQuaternion.clone():null,scaling:e.scaling.clone()}),e.isVisible=!1,e.setEnabled(!1)});const n=(e,n,r)=>{const i=new a.TransformNode(n,s);return i.parent=e,i.rotation=new a.Vector3(0,r,0),t.forEach(e=>{const t=e.createInstance(`${e.name}-${n}`);t.parent=i,((e,t)=>{const n=o.get(t);n&&(e.position=n.position.clone(),e.scaling=n.scaling.clone(),n.rotationQuaternion?(e.rotationQuaternion=n.rotationQuaternion.clone(),e.rotation=a.Vector3.Zero()):n.rotation&&(e.rotation=n.rotation.clone(),e.rotationQuaternion=null))})(t,e),t.receiveShadows=!0,t.alwaysSelectAsActiveMesh=!0}),i},r=new a.TransformNode("buildingsSeg-0",s);r.position=a.Vector3.Zero(),n(r,"B_a_group_seg-0",0),n(r,"B_b_group_seg-0",Math.PI);const{min:d,max:f}=r.getHierarchyBoundingVectors(),g=Math.abs(f.z-d.z),h=Math.max(g-1,10),p=(e,t)=>{e.position=new a.Vector3(0,0,-t*h),i.push(e)},w=e=>{const t=new a.TransformNode(`buildingsSeg-${e}`,s);t.position=new a.Vector3(0,0,-e*h),n(t,`B_a_group_seg-${e}`,0),n(t,`B_b_group_seg-${e}`,Math.PI),p(t,e)};p(r,0);for(let e=1;e<6;e+=1)w(e);c=s.onBeforeRenderObservable.add(()=>{const e=s.getEngine().getDeltaTime()/1e3,t=u*e;if(0===t)return;const o=(e,o)=>{if(0===e.length)return;e.forEach(e=>{e.position.z+=t});let n=1/0;e.forEach(e=>{e.position.z<n&&(n=e.position.z)}),e.forEach(e=>{e.position.z>o&&(e.position.z=n-o)})};o(i,h),o(l,160),$.offset+=t/160,$.offset%=1,$.offset<0&&($.offset+=1),K.vOffset=$.offset})}).catch(e=>{console.error("Error loading building assets:",e)}),o.runRenderLoop(()=>{B(),s.render()}),window.addEventListener("resize",r),window.addEventListener("keydown",x),window.addEventListener("keyup",V),()=>{window.removeEventListener("resize",r),window.removeEventListener("keydown",x),window.removeEventListener("keyup",V),c&&s.onBeforeRenderObservable.remove(c),R&&s.onBeforeRenderObservable.remove(R),A(),i.forEach(e=>e.dispose()),l.forEach(e=>e.dispose()),o.dispose()}},[]),(0,n.jsx)("canvas",{ref:e,style:{display:"block",margin:"0 auto"}})}}}]);