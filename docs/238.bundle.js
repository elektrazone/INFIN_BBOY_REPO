"use strict";(self.webpackChunkbabylon_react_916_canvas=self.webpackChunkbabylon_react_916_canvas||[]).push([[238],{238:(e,t,o)=>{o.r(t),o.d(t,{default:()=>s});var n=o(848),r=o(540),a=o(828);o(988),a.DracoCompression&&(a.DracoCompression.Configuration={decoder:{wasmUrl:"https://cdn.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://cdn.babylonjs.com/draco_wasm_wrapper_gltf.wasm",fallbackUrl:"https://cdn.babylonjs.com/draco_decoder_gltf.js"}});const s=()=>{const e=(0,r.useRef)(null);return(0,r.useEffect)(()=>{const t=e.current;if(!t)return;let o=null;const n=()=>{if(!o)return;const e=Math.max(1,t.height/1080);o.setHardwareScalingLevel(Math.min(2.5,e))},r=()=>{let e=Math.min(window.innerHeight,3840),r=9*e/16;r>2160&&(r=2160,e=Math.min(16*r/9,3840)),t.width=r,t.height=e,t.style.width=`${r}px`,t.style.height=`${e}px`,o&&(o.resize(),n())};r(),o=new a.Engine(t,!0),a.Logger.ClearLogCache(),a.Logger.LogLevels=a.Logger.NoneLogLevel,n();const s=new a.Scene(o),l=[];let i=0;const c=[];let d=null;const u=102;let f=0;const g={Idle:[0,88],Run:[89,109],Strafe_L:[182,201],Strafe_R:[202,221]},p=(e,t)=>{const[o,n]=g[e];return{start:o,end:n,loop:!0,scroll:t}},h={Idle:p("Idle",0),Run:p("Run",u),Slide:{start:110,end:154,loop:!1,scroll:u},Jump:{start:155,end:181,loop:!1,scroll:u},Strafe_L:p("Strafe_L",u),Strafe_R:p("Strafe_R",u),Run_Idle:{start:222,end:248,loop:!1,scroll:0},Fall:{start:249,end:324,loop:!1,scroll:u},Getup:{start:325,end:552,loop:!1,scroll:u}},m=(e,t)=>{if(M){const t=M.getAnimationRange(e);if(t)return{start:t.from,end:t.to}}return{start:t.start,end:t.end}},w=new Set(["Slide","Jump","Fall","Getup"]),b={forward:!1,left:!1,right:!1,slide:!1,jump:!1},v={Digit1:"Idle",Digit2:"Run",Digit3:"Slide",Digit4:"Jump",Digit5:"Run_Idle"};let L=null,M=null,S=null,y=24,_=null,A=null,E=null,R="Idle",x=!1,I=null,D=null,k=!1;const O={target:0},T=()=>{_&&A&&(_.onAnimationEndObservable.remove(A),A=null),S&&E&&(S.onAnimationGroupEndObservable.remove(E),E=null),S&&S.stop(),_&&(_.stop(),_=null)},C=(e,t=!1)=>{if(!t&&R===e)return;if(!t&&w.has(R))return;x=!!w.has(e);const o=h[e],n=m(e,o);if(!M&&!S)return f=o.scroll,void(R=e);T();const r=()=>{x=!1,"Slide"===e||"Jump"===e?C("Run",!0):("Getup"===e||"Run_Idle"===e)&&C("Idle",!0)};let a=!1;if(S){const e=y/24,t=n.start*e,s=n.end*e;S.reset(),S.start(o.loop,1,t,s,!1),a=!0,o.loop||(E=S.onAnimationGroupEndObservable.addOnce(()=>{E=null,r()})),_=null}else M&&(_=s.beginAnimation(M,n.start,n.end,o.loop,1),_&&(a=!0,o.loop||(A=_.onAnimationEndObservable.addOnce(()=>{A=null,r()}))));if(!a)return f=o.scroll,void(R=e);f=o.scroll,R=e},V=()=>{if(k)return;const e=m("Idle",h.Idle);if(S){const t=y/24,o=e.start*t,n=e.end*t;S.reset(),S.start(!0,1,o,n,!0),k=!0,_=null}else M&&(_=s.beginAnimation(M,e.start,e.end,!0),_&&(k=!0))},B=e=>{b.forward=!1,b.left=!1,b.right=!1,b.slide=!1,b.jump=!1,L=e,C(e||"Idle",!0)},N=e=>{const t=v[e.code];if(t)return e.preventDefault(),void B(t);if("Digit0"===e.code)return e.preventDefault(),void B(null);switch(e.code){case"ArrowUp":case"KeyW":b.forward=!0;break;case"ArrowLeft":case"KeyA":b.left=!0;break;case"ArrowRight":case"KeyD":b.right=!0;break;case"ArrowDown":case"KeyS":b.slide=!0;break;case"Space":e.preventDefault(),b.jump=!0}},j=e=>{switch(e.code){case"ArrowUp":case"KeyW":b.forward=!1;break;case"ArrowLeft":case"KeyA":b.left=!1;break;case"ArrowRight":case"KeyD":b.right=!1;break;case"ArrowDown":case"KeyS":b.slide=!1;break;case"Space":e.preventDefault(),b.jump=!1}},P=e=>Math.max(-40,Math.min(40,e));D=s.onBeforeRenderObservable.add(()=>{const e=s.getEngine().getDeltaTime()/1e3;if((()=>{if(!I)return;if(L)return;const e=b.left&&!b.right,t=b.right&&!b.left,o=b.slide,n=b.forward||x;let r=!1;b.jump&&(x||(C("Jump"),r=!0),b.jump=!1),r||C(o?"Slide":e?"Strafe_L":t?"Strafe_R":n?"Run":"Idle")})(),!I)return;const t=I.position.clone();if(b.left&&!b.right)O.target=P(O.target-40*e);else if(b.right&&!b.left)O.target=P(O.target+40*e);else{const t=40*Math.sign(-O.target)*e;Math.abs(t)>Math.abs(O.target)?O.target=0:O.target+=t}t.x=O.target,I.position=t}),new a.HemisphericLight("light",new a.Vector3(0,1,0),s).intensity=.9;const $=new a.ArcRotateCamera("camera",Math.PI/2,Math.PI/3,25,new a.Vector3(0,8,0),s);$.attachControl(t,!0);const z=new a.ShadowGenerator(2048,new a.DirectionalLight("dirLight",new a.Vector3(-.5,-1,.5),s));z.useExponentialShadowMap=!0;const G="undefined"!=typeof window&&window.location.hostname.endsWith("github.io")?"https://media.githubusercontent.com/media/elektrazone/INFIN_BBOY_REPO/main/public/scene/assets/":"scene/assets/",K=`${G}model/`,W=`${G}road/`;let Q=160,H=6;const U=new a.StandardMaterial("groundMaterial",s);U.diffuseColor=new a.Color3(.12,.12,.14),U.specularColor=new a.Color3(.02,.02,.02),U.emissiveColor=new a.Color3(.01,.01,.012);const J=e=>{e.uScale=1,e.vScale=Math.max(1,2*H),e.wrapU=a.Texture.CLAMP_ADDRESSMODE,e.wrapV=a.Texture.WRAP_ADDRESSMODE,e.hasAlpha=!1},{packagedTexture:F,dynamicTexture:Z}=(()=>{const e=`${W}fallback-road-texture.png`,t=new a.Texture(e,s,void 0,!1,a.Texture.TRILINEAR_SAMPLINGMODE,void 0,()=>{t.dispose()});t.onLoadObservable.addOnce(()=>{t.updateSamplingMode(a.Texture.TRILINEAR_SAMPLINGMODE)});const o=new a.DynamicTexture("runner-road-fallback",{width:1024,height:1024},s,!1),n=o.getContext();if(n){const e=1024;n.fillStyle="#201f2b",n.fillRect(0,0,e,e),n.fillStyle="#14131d",n.fillRect(0,.08*e,e,.84*e),n.fillStyle="#fcd75a";const t=Math.max(1,Math.round(.005*e)),o=Math.max(1,Math.round(.01*e)),r=Math.max(1,1*o),a=(e-t)/2;for(let s=0*e;s<e+o;s+=o+r)n.fillRect(a,s,t,o)}return o.update(!1),{packagedTexture:t,dynamicTexture:o}})();J(Z),U.diffuseTexture=Z;let Y=Z;const q={offset:0};let X=null;const ee=e=>{J(e),U.diffuseTexture=e,Y=e};F.onLoadObservable.addOnce(()=>{ee(F)});const te=`${W}road_texture.jpg`;X=new a.Texture(te,s,void 0,!1,a.Texture.TRILINEAR_SAMPLINGMODE,()=>{X&&ee(X)},()=>{F&&F.isReady()?ee(F):ee(Z)}),X.onLoadObservable.addOnce(()=>{X&&ee(X)});const oe=(e,t)=>{const o=a.MeshBuilder.CreateGround(`ground-${e}`,{width:250,height:t},s);return o.position=new a.Vector3(0,0,-e*t),o.material=U,o.receiveShadows=!0,o},ne=(e,t)=>{c.splice(0).forEach(e=>e.dispose()),Q=e,H=t;for(let o=0;o<t;o+=1){const t=oe(o,e);c.push(t)}q.offset=0,Y&&J(Y)};ne(Q,H);const re=(e,t,o)=>{if(0===e.length)return;e.forEach(e=>{e.position.z+=o});let n=1/0;e.forEach(e=>{e.position.z<n&&(n=e.position.z)}),e.forEach(e=>{e.position.z>t&&(e.position.z=n-t)})};d=s.onBeforeRenderObservable.add(()=>{const e=s.getEngine().getDeltaTime()/1e3,t=f*e;0!==t&&(re(c,Q,t),i>0&&re(l,i,t),q.offset-=t/Q,q.offset%=1,q.offset<0&&(q.offset+=1),Y.vOffset=q.offset)});const ae=K;a.SceneLoader.ImportMesh(null,ae,"player.glb",s,(e,t,o,n)=>{var r,l,i;if(console.log("Loaded meshes:",e),console.log("Loaded animationGroups:",n),0===e.length)return void console.error("No meshes loaded from player.glb");const c=new a.TransformNode("playerRoot",s);e.forEach(e=>{e.parent=c,e.alwaysSelectAsActiveMesh=!0,e.setEnabled(!0),e instanceof a.Mesh&&(e.receiveShadows=!0,z.addShadowCaster(e,!0))});const d=null!==(l=null!==(r=e.find(e=>e instanceof a.Mesh&&!!e.skeleton))&&void 0!==r?r:e.find(e=>e instanceof a.Mesh))&&void 0!==l?l:null,u=null!=d?d:e[0]||null;c.position=a.Vector3.Zero(),c.scaling=a.Vector3.One(),c.computeWorldMatrix(!0);const f=o[0]||(null==d?void 0:d.skeleton)||null,{min:g,max:p}=c.getHierarchyBoundingVectors(),m=p.y-g.y,w=m>0?16/m:1;c.scaling=new a.Vector3(w,w,w),c.computeWorldMatrix(!0),c.rotate(a.Axis.Y,Math.PI,a.Space.LOCAL),c.computeWorldMatrix(!0);const{min:b,max:v}=c.getHierarchyBoundingVectors(),L=b.add(v).scale(.5);if(c.position=new a.Vector3(-L.x,.05-b.y,7.5-L.z),c.computeWorldMatrix(!0),u?$.lockedTarget=u:$.setTarget(c.position.clone()),I=c,M=f,S=n.find(e=>e.targetedAnimations.length>0)||null,n.forEach(e=>{e!==S&&e.stop()}),S){const e=S.targetedAnimations[0];(null===(i=null==e?void 0:e.animation)||void 0===i?void 0:i.framePerSecond)&&(y=e.animation.framePerSecond),S.reset()}else f&&(e=>{Object.keys(h).forEach(t=>{if(!e.getAnimationRange(t)){const{start:o,end:n}=h[t];e.createAnimationRange(t,o,n)}})})(f);V()},void 0,(e,t,o)=>{console.error("Error loading player.glb:",t,o)});const se=Array.from({length:10},(e,t)=>`b${t+1}.glb`);return Promise.all(se.map(e=>a.SceneLoader.ImportMeshAsync(null,ae,e,s).then(e=>e.meshes.filter(e=>e instanceof a.Mesh)))).then(e=>{const t=e.flat();if(0===t.length)return void console.error("No renderable meshes found in b1â€“b10 assets.");const o=new Map;t.forEach(e=>{e.scaling=e.scaling.scale(8),o.set(e,{position:e.position.clone(),rotation:e.rotation?e.rotation.clone():null,rotationQuaternion:e.rotationQuaternion?e.rotationQuaternion.clone():null,scaling:e.scaling.clone()}),e.isVisible=!1,e.setEnabled(!1)});const n=(e,n,r)=>{const l=new a.TransformNode(n,s);return l.parent=e,l.rotation=new a.Vector3(0,r,0),t.forEach(e=>{const t=e.createInstance(`${e.name}-${n}`);t.parent=l,((e,t)=>{const n=o.get(t);n&&(e.position=n.position.clone(),e.scaling=n.scaling.clone(),n.rotationQuaternion?(e.rotationQuaternion=n.rotationQuaternion.clone(),e.rotation=a.Vector3.Zero()):n.rotation&&(e.rotation=n.rotation.clone(),e.rotationQuaternion=null))})(t,e),t.receiveShadows=!0,t.alwaysSelectAsActiveMesh=!1}),l},r=new a.TransformNode("buildingsSeg-0",s);r.position=a.Vector3.Zero(),n(r,"B_a_group_seg-0",0),n(r,"B_b_group_seg-0",Math.PI);const{min:c,max:d}=r.getHierarchyBoundingVectors(),u=Math.abs(d.z-c.z),f=Math.max(u-1,10);i=f,ne(f,6);const g=(e,t)=>{e.position=new a.Vector3(0,0,-t*f),l.push(e)},p=e=>{const t=new a.TransformNode(`buildingsSeg-${e}`,s);t.position=new a.Vector3(0,0,-e*f),n(t,`B_a_group_seg-${e}`,0),n(t,`B_b_group_seg-${e}`,Math.PI),g(t,e)};g(r,0);for(let e=1;e<6;e+=1)p(e)}).catch(e=>{console.error("Error loading building assets:",e)}),o.runRenderLoop(()=>{V(),s.render()}),window.addEventListener("resize",r),window.addEventListener("keydown",N),window.addEventListener("keyup",j),()=>{window.removeEventListener("resize",r),window.removeEventListener("keydown",N),window.removeEventListener("keyup",j),a.Logger.ClearLogCache(),a.Logger.LogLevels=a.Logger.AllLogLevel,d&&s.onBeforeRenderObservable.remove(d),D&&s.onBeforeRenderObservable.remove(D),T(),l.forEach(e=>e.dispose()),c.forEach(e=>e.dispose()),o.dispose()}},[]),(0,n.jsx)("canvas",{ref:e,style:{display:"block",margin:"0 auto"}})}}}]);